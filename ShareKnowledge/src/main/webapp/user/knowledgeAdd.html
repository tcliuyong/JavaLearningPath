<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>User Account - Bootstrap Admin</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link href="../css/bootstrap.min.css" rel="stylesheet" />
    <link href="../css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="../css/font-awesome.css" rel="stylesheet" />
    <link href="../css/adminia.css" rel="stylesheet" />
    <link href="../css/adminia-responsive.css" rel="stylesheet" />
    <link href="../css/pages/plans.css" rel="stylesheet" />
	<script src="../js/jquery-1.8.3.min.js"></script>
	<script src="../js/bootstrap.js"></script>
	<script src="../js/jquery-jtemplates.js"></script>
	<script src="../js/jquerycookie.js"></script>
	<script src="../js/check.js"></script>
	<script src="../js/ajaxfileupload.js"></script>
	<link href="../umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	<script type="text/javascript" charset="utf-8" src="../umeditor/umeditor.config.js"></script>
	<script type="text/javascript" charset="utf-8" src="../umeditor/umeditor.min.js"></script>
	<script type="text/javascript" src="../umeditor/lang/zh-cn/zh-cn.js"></script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	<script>
		  var ui = $.cookie("_ui");
		  $.ajax({
			  type: 'post',
			  url: "/getUserByToken.do" ,
			  data: ui,
			  headers: {'Content-Type': 'application/json'},
			  success: function(data){
				  if(data == null){
					  alert("请求失败");
				  }else{
					  // 设置模板
					  $("#knowledgeAdd").setTemplateURL("../template/knowledgeAdd.html");
					  //   加载数据
					  $("#knowledgeAdd").processTemplate(data);
					  $("#userMenu").setTemplateURL("../template/userMenu.html");
					  $("#userMenu").processTemplate("");
					  $.ajax({
						  type: 'post',
						  url: "/getSelectList.do" ,
						  data: "",
						  headers: {'Content-Type': 'application/json'},
						  success: function(datalist){
							  // 设置模板
							  $("#selectList").setTemplateURL("../template/selectList.html");
							  //   加载数据
							  $("#selectList").processTemplate(datalist);
							  return ;
						  },
						  dataType: 'json'
					  });
				  }
				  return ;
			  },
			  dataType: 'json'
		  });

	  </script>

	<script>
	function save(){
			if($(":input#title").val() == "" || $(":input#tag").val() == "" || $(":input#system").val()== "" ||
					UM.getEditor('myEditor').getContentTxt() == "" ||
					$(":input#language").val() == ""){
				alert("有的选项为空");
				return;
			}
			var arr = [];
			arr.push(UM.getEditor('myEditor').getContent());
			var jsonStr = {"user":{"id":$(":input#id").val()},"title": $(":input#title").val(),
			"tag" : $(":input#tag").val(), "category": $("#category  option:selected").val(),
				"language": $("#language  option:selected").val(),
				"system":$(":input#system").val(),"content":arr.join("\n")};
			var knowledge = JSON.stringify(jsonStr);

			$.ajax({
				type: 'post',
				url: "/addKnowledge.do" ,
				headers: {'Content-Type': 'application/json'},
				data:knowledge,
				success: function(data){
					if(data == -1){
						alert("更新失败，请稍后");
						return;
					}else {
						$.ajaxFileUpload({
							type: 'post',
							url: "/uploadFile.do?id="+data ,
							secureuri:true,
							fileElementId:'uploadFile',
							success: function(data) {
								if(data == "OK"){
									alert("添加成功");
									window.location="knowledgeManage.html";
								}else if(data == "EXCEPTION"){
									alert("图片超过限制或后缀名不允许");
								}else {
									alert("上传失败");
								}
								return;
							},
							dataType: 'text'
						});
					}
				},
				dataType: 'text'
			});
		}

	</script>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>

<body>
<!--style给定宽度可以影响编辑器的最终宽度-->
<div id="knowledgeAdd" nowrap></div>
  </body>

</html>
