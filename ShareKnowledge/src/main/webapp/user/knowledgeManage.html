<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>知识管理</title>

	  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	  <meta name="apple-mobile-web-app-capable" content="yes" />
	  <link href="../css/bootstrap.min.css" rel="stylesheet" />
	  <link href="../css/bootstrap-responsive.min.css" rel="stylesheet" />
	  <link href="../css/font-awesome.css" rel="stylesheet" />
	  <link href="../css/adminia.css" rel="stylesheet" />
	  <link href="../css/adminia-responsive.css" rel="stylesheet" />
	  <link href="../css/pages/plans.css" rel="stylesheet" />

	  <link href="../css/page.css" rel="stylesheet" />

	  <script src="../js/jquery-1.8.3.min.js"></script>
	  <script src="../js/bootstrap.js"></script>
	  <script src="../js/jquery-jtemplates.js"></script>
	  <script src="../js/jquerycookie.js"></script>
	  <script src="../js/check.js"></script>
	  <script src="../js/ajaxfileupload.js"></script>
	  <link href="../umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
	  <script type="text/javascript" charset="utf-8" src="../umeditor/umeditor.config.js"></script>
	  <script type="text/javascript" charset="utf-8" src="../umeditor/umeditor.min.js"></script>
	  <script type="text/javascript" src="../umeditor/lang/zh-cn/zh-cn.js"></script>
	  <script src="../js/jquery.page.js"></script>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
  <script>
	  var ui = $.cookie("_ui");
	  $.ajax({
		  type: 'post',
		  url: "/getUserByToken.do" ,
		  data: ui,
		  headers: {'Content-Type': 'application/json'},
		  success: function(data){
			  if(data == null){
				  alert("请求失败");
			  }else{
				  $("#userMenu").setTemplateURL("../template/userMenu.html");
				  $("#userMenu").processTemplate("");
				  $("#face").setTemplateURL("../template/face.html");
				  $("#face").processTemplate(data);
				  var jsonStr = {"uid":data["id"],"page": 1,"pagesize":10};
				  var page = JSON.stringify(jsonStr);
				  $.ajax({
					  type: 'post',
					  url: "/getCountKnowledge.do" ,
					  data: data["id"].toString(),
					  success: function(pagecount){
						  if(pagecount != null){
							  $(".tcdPageCode").createPage({
								  pageCount : pagecount,
								  current : 1,
								  backFn:function(p){
									  var jsonStr = {"uid":$(":input#user_id").val(),"page": p,"pagesize":10};
									  var page = JSON.stringify(jsonStr);
									  $.ajax({
										  type: 'post',
										  url: "/getKnowledgeListByPage.do" ,
										  data: page,
										  headers: {'Content-Type': 'application/json'},
										  success: function(knowledgeList){
											  if(knowledgeList == null){
												  alert("请求失败");
											  }else{
												  $("#knowledgeTable").setTemplateURL("../template/knowledgeTable.html");
												  $("#knowledgeTable").processTemplate(knowledgeList);
											  }
											  return ;
										  },
										  dataType: 'json'
									  });
								  }
							  });
						  }
					  },
					  dataType: 'text'
				  });
				  $.ajax({
					  type: 'post',
					  url: "/getKnowledgeListByPage.do" ,
					  data: page,
					  headers: {'Content-Type': 'application/json'},
					  success: function(knowledgeList){
						  if(knowledgeList == null){
							  alert("请求失败");
						  }else{
							  $("#knowledgeTable").setTemplateURL("../template/knowledgeTable.html");
							  $("#knowledgeTable").processTemplate(knowledgeList);
						  }
						  return ;
					  },
					  dataType: 'json'
				  });
			  }
			  return ;
		  },
		  dataType: 'json'
	  });
  </script>

<body>
<div class="navbar navbar-fixed-top">

	<div class="navbar-inner">

		<div class="container">

			<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>

			<a class="brand" href="./">Adminia Admin</a>

			<div class="nav-collapse">

				<ul class="nav pull-right">
					<li>
						<a href="#"><span class="badge badge-warning">7</span></a>
					</li>

					<li class="divider-vertical"></li>

					<li class="dropdown">

						<a data-toggle="dropdown" class="dropdown-toggle " href="#">
							Rod Howard <b class="caret"></b>
						</a>

						<ul class="dropdown-menu">
							<li>
								<a href="personal.html"><i class="icon-user"></i> Account Setting  </a>
							</li>

							<li>
								<a href="./change_password.html"><i class="icon-lock"></i> Change Password</a>
							</li>

							<li class="divider"></li>

							<li>
								<a href="./"><i class="icon-off"></i> Logout</a>
							</li>
						</ul>
					</li>
				</ul>

			</div> <!-- /nav-collapse -->

		</div> <!-- /container -->

	</div> <!-- /navbar-inner -->

</div> <!-- /navbar -->
<div id="content">
	<div class="container">
		<div class="row">

			<div class="span3">

				<div class="account-container">

					<div id="face" nowrap></div>


				</div> <!-- /account-container -->

				<div id="userMenu" nowrap></div>

				<br />

			</div> <!-- /span3 -->

			<div class="span9">

				<h1 class="page-title">
					<i class="icon-home"></i>
					知识管理
				</h1>

				<div class="widget widget-table">

					<div class="widget-header">
						<i class="icon-th-list"></i>
						<h3>知识列表</h3>
					</div> <!-- /widget-header -->

					<div class="widget-content">

						<div id="knowledgeTable" nowrap></div>
						<div class="tcdPageCode"></div>


					</div> <!-- /widget-content -->

				</div> <!-- /widget -->

			</div> <!-- /row -->

		</div> <!-- /span9 -->


	</div> <!-- /row -->

</div> <!-- /container -->

<div id="footer">
	<div class="container">
		<hr />
		<p>&copy; 2016 Go Ideate.</p>
	</div> <!-- /container -->
</div> <!-- /footer -->

<script>
	function removeKno(kid){
		var jsonStr = {"cookie":$.cookie("_ui"),"k_id": Number(kid)};
		var DelKnoDTO = JSON.stringify(jsonStr);
		$.ajax({
			type: 'post',
			url: "/delKnowledge.do" ,
			data: DelKnoDTO,
			headers: {'Content-Type': 'application/json'},
			success: function(res){
				if(res == "FAIL"){
					alert("请求失败");
				}else{
					alert("删除成功");
					window.location="/user/knowledgeManage.html";
				}
				return ;
			},
			dataType: 'text'
		});
	}
</script>
</body>
</html>
